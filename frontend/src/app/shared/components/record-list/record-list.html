<main class="main-content bg-white rounded-lg border border-slate-200">
  <div class="overflow-x-auto">
    <!-- The routerLink directive will be imported in the parent component -->
    @if (recordState.records().length > 0) {
      <table class="min-w-full">
        <thead>
          <tr class="border-b border-slate-200">
            <th class="p-4 w-12 text-left text-sm font-bold text-slate-800">
              <input
                type="checkbox"
                class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"
                [checked]="isSelectAllChecked()"
                [indeterminate]="isAnyButNotAllSelected()"
                (click)="onSelectAll(); $event.preventDefault()"
              />
            </th>
            <th class="p-4 text-left text-sm font-semibold text-slate-800">Patient Name</th>
            <th class="hidden p-4 text-left text-sm font-semibold text-slate-800 md:table-cell">
              Record #
            </th>
            <th class="p-4 text-left text-sm font-semibold text-slate-800">Final Diagnosis</th>
            <th class="hidden p-4 text-left text-sm font-semibold text-slate-800 lg:table-cell">
              Category
            </th>
          </tr>
        </thead>
        <tbody class="bg-white">
          @for (record of recordState.records(); track record.id) {
            <tr
              class="cursor-pointer transition-all duration-150 border-l-4 border-transparent border-b border-slate-200"
              [routerLink]="['/records', record.id]"
              [class.bg-primary-light]="recordState.selectedRecordIds().has(record.id)"
              [class.border-l-primary]="recordState.selectedRecordIds().has(record.id)"
              [class.hover:bg-slate-100]="!recordState.selectedRecordIds().has(record.id)"
              [class.hover:border-l-primary]="!recordState.selectedRecordIds().has(record.id)"
            >
              <td class="py-3 px-4">
                <input
                  type="checkbox"
                  class="patient-checkbox h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"
                  [checked]="recordState.selectedRecordIds().has(record.id)"
                  (click)="$event.stopPropagation(); onSelectRow(record.id, $event)"
                />
              </td>
              <td class="py-3 px-4 text-sm font-normal text-slate-800">
                <div>{{ record.name || 'N/A' }}</div>
                <div class="font-normal text-slate-500 md:hidden">
                  #{{ record.patient_info.patient_record_number || 'N/A' }}
                </div>
              </td>
              <td class="hidden py-3 px-4 text-sm text-slate-600 md:table-cell">
                {{ record.patient_info.patient_record_number || 'N/A' }}
              </td>
              <td class="py-3 px-4 text-sm text-slate-600 max-w-xs truncate">
                {{ getFinalDiagnosis(record) }}
              </td>
              <td class="hidden py-3 px-4 text-sm text-slate-600 lg:table-cell">
                {{ record.patient_info.category || 'N/A' }}
              </td>
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <div class="text-center py-16 text-slate-500">
        <i class="fa-solid fa-folder-open fa-2x mb-3"></i>
        <p class="font-semibold">No Records Found</p>
        <p class="text-sm">There are no patient records matching your criteria.</p>
      </div>
    }
  </div>
  <footer
    class="flex flex-col items-center justify-between gap-4 border-t border-slate-200 p-4 md:flex-row"
  >
    <div class="flex items-center gap-3 self-start md:self-center">
      <span class="text-sm text-slate-600">Rows per page:</span>
      <select
        class="px-2 py-1 text-sm border border-slate-200 rounded-md bg-white"
        (change)="onRowsPerPageChange($event)"
      >
        <option class="p-2" value="10" [selected]="recordState.rowsPerPage() === 10">10</option>
        <option class="p-2" value="25" [selected]="recordState.rowsPerPage() === 25">25</option>
        <option class="p-2" value="50" [selected]="recordState.rowsPerPage() === 50">50</option>
      </select>
      <span class="text-sm text-slate-600">{{ getPaginationSummary() }}</span>
    </div>
    <nav class="self-end md:self-center">
      <div class="flex items-center gap-2">
        <button
          class="inline-flex h-9 w-9 items-center justify-center rounded-md border border-slate-200 text-sm font-medium transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50"
          [disabled]="recordState.currentPage() === 1"
          (click)="onPageChange(recordState.currentPage() - 1)"
        >
          Prev
        </button>
        @for (page of [].constructor(recordState.totalPages()); track $index) {
          <button
            class="hidden h-9 w-9 items-center justify-center rounded-md border border-slate-200 text-sm font-medium transition-colors sm:inline-flex"
            [class.bg-primary]="$index + 1 === recordState.currentPage()"
            [class.text-white]="$index + 1 === recordState.currentPage()"
            [class.border-primary]="$index + 1 === recordState.currentPage()"
            [class.hover:bg-slate-50]="$index + 1 !== recordState.currentPage()"
            (click)="onPageChange($index + 1)"
          >
            {{ $index + 1 }}
          </button>
        }
        <button
          class="inline-flex h-9 w-9 items-center justify-center rounded-md border border-slate-200 text-sm font-medium transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50"
          [disabled]="recordState.currentPage() === recordState.totalPages()"
          (click)="onPageChange(recordState.currentPage() + 1)"
        >
          Next
        </button>
      </div>
    </nav>
  </footer>
</main>
